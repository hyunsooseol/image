<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>jamovi Tutorial – 파일 불러오기</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{ --pad:16px; }
  html,body{ height:100%; margin:0; }
  body{ font-family:"Noto Sans KR",system-ui; background:#0b1020; color:#e5e7eb; }
  .app{ height:100vh; display:flex; flex-direction:column; }
  .topbar{ display:flex; align-items:center; justify-content:space-between; padding:12px var(--pad); }
  .title{ margin:0; font-weight:700; letter-spacing:.2px; opacity:.95; }
  .btn-group{ display:flex; gap:8px; }
  .btn{ padding:8px 16px; border:1px solid #334155; background:#111827; color:#fff; border-radius:10px; cursor:pointer; font-weight:600; transition:.15s }
  .btn:hover{ background:#1f2937; transform:translateY(-1px) }
  .btn:disabled{ opacity:.5; cursor:not-allowed; background:#111827!important; transform:none!important }
  .btn.primary{ background:#3b82f6; border-color:#3b82f6 }
  .btn.primary:hover{ background:#2563eb }
  .stage-wrap{ flex:1; min-height:0; display:flex; align-items:center; justify-content:center; padding:0 var(--pad) var(--pad); position:relative }
  .guide{ position:absolute; top:20px; left:50%; transform:translateX(-50%); background:linear-gradient(135deg,#3b82f6,#8b5cf6); padding:12px 24px; border-radius:12px; font-weight:600; font-size:15px; box-shadow:0 8px 24px rgba(59,130,246,.35); animation:pulse 2s ease-in-out infinite; z-index:20 }
  @keyframes pulse{ 0%,100%{transform:translateX(-50%) scale(1)} 50%{transform:translateX(-50%) scale(1.03)} }
  .stage{ position:relative; display:inline-block; line-height:0 }
  .shot{ display:block; width:1200px; max-width:100%; height:auto; border-radius:14px }
  #spot{ position:absolute; z-index:10; cursor:pointer; border-radius:12px; box-shadow:0 0 0 9999px rgba(0,0,0,.72),0 10px 26px rgba(0,0,0,.35); background:transparent; transition:.18s ease-out }
  #spot::before{ content:""; position:absolute; inset:-6px; border-radius:16px; border:2.5px dashed rgba(255,255,255,.95); box-shadow:0 0 30px rgba(255,255,255,.35); pointer-events:none }
  #spot:hover{ box-shadow:0 0 0 9999px rgba(0,0,0,.72),0 14px 34px rgba(0,0,0,.42) }
  #spot.busy::after{ content:""; position:absolute; left:50%; top:50%; width:28px; height:28px; margin:-14px 0 0 -14px; border:3px solid rgba(255,255,255,.92); border-top-color:transparent; border-radius:50%; animation:spin .8s linear infinite }
  @keyframes spin{ to{ transform:rotate(360deg) } }
  #tip{ position:absolute; z-index:11; max-width:320px; padding:10px 12px; border-radius:10px; font-size:14px; background:#0b1220; color:#e5e7eb; border:1px solid #1f2937; box-shadow:0 6px 18px rgba(0,0,0,.25) }
  #tip h4{ margin:0 0 4px; font-size:15px; font-weight:600 }
  .badge{ position:absolute; right:8px; bottom:8px; color:#d1d5db; opacity:.85; font-size:13px; pointer-events:none }
  .loading-note{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#0b1220; border:1px solid #1f2937; padding:10px 14px; border-radius:10px; font-size:13px; color:#e5e7eb; box-shadow:0 6px 18px rgba(0,0,0,.25) }
  .error-note{ position:fixed; left:12px; bottom:12px; background:#991b1b; color:#fff; padding:10px 14px; border-radius:10px; font-size:12px; box-shadow:0 6px 18px rgba(0,0,0,.25) }
</style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <h2 class="title">jamovi cloud tutorial – 파일 불러오기</h2>
    <div class="btn-group">
      <button class="btn" id="prevBtn" disabled>← 이전</button>
      <button class="btn primary" id="startBtn">시작</button>
      <button class="btn" id="nextBtn" disabled>다음 →</button>
    </div>
  </div>

  <div class="stage-wrap">
    <div class="guide" id="guide" hidden>💡 하이라이트 박스를 클릭하세요</div>
    <div class="stage" id="stage">
      <!-- 절대경로 + 캐시버스터 -->
      <img id="shot" class="shot" src="https://hyunsooseol.github.io/image/1.png?v=20251014" alt="jamovi">
      <div id="spot" hidden></div>
      <div id="tip" hidden><h4 id="tip-title"></h4><div id="tip-desc"></div></div>
      <div class="badge" id="prog">Step 0 of 0</div>
      <div class="loading-note" id="loading" hidden>이미지 로딩 중…</div>
    </div>
  </div>
</div>

<script>
  // 절대경로 + 캐시버스터 사용
  const V = '20251014';
  const IMG = n => `https://hyunsooseol.github.io/image/${n}.png?v=${V}`;

  const steps = [
    { img: IMG(1), box:[0, 54, 40, 30],  title:'', desc:'왼쪽 상단 (☰) 영역을 클릭하세요.' },
    { img: IMG(2), box:[20, 230, 80, 30], title:'', desc:'"This Device"를 클릭하세요.' },
    { img: IMG(3), box:[700, 360, 60, 30], title:'', desc:'로컬 파일을 선택/업로드.' },
    { img: IMG(4), box:[0, 130, 400, 500], title:'', desc:'데이터시트를 확인하세요.' },
  ];

  const shot = document.getElementById('shot');
  const spot = document.getElementById('spot');
  const tip = document.getElementById('tip');
  const tipTitle = document.getElementById('tip-title');
  const tipDesc = document.getElementById('tip-desc');
  const prog = document.getElementById('prog');
  const guide = document.getElementById('guide');
  const loading = document.getElementById('loading');
  const startBtn = document.getElementById('startBtn');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  let idx = -1, locked = false;

  function updateButtons(){
    prevBtn.disabled = (idx <= 0);
    nextBtn.disabled = (idx >= steps.length - 1);
    if(idx >= 0){ startBtn.textContent = '다시 시작'; startBtn.classList.remove('primary'); }
  }

  function place(i){
    const [L,T,W,H] = steps[i].box;
    const scale = shot.offsetWidth / 1200;

    spot.style.left = Math.round(L*scale)+'px';
    spot.style.top  = Math.round(T*scale)+'px';
    spot.style.width= Math.round(W*scale)+'px';
    spot.style.height=Math.round(H*scale)+'px';
    spot.hidden = false; spot.classList.remove('busy');

    tipTitle.textContent = steps[i].title;
    tipDesc.textContent  = steps[i].desc;

    const tipW=320; let tipLeft=L*scale+W*scale+12, tipTop=T*scale;
    if(tipLeft+tipW>shot.offsetWidth) tipLeft = Math.max(0, L*scale - tipW - 12);
    tip.style.left = Math.round(tipLeft)+'px';
    tip.style.top  = Math.round(tipTop)+'px';
    tip.hidden = false;

    prog.textContent = `Step ${i+1} of ${steps.length}`;
    guide.hidden = false;
    updateButtons();
  }

  function note(msg){
    const n = document.createElement('div');
    n.className = 'error-note';
    n.textContent = msg;
    document.body.appendChild(n);
    setTimeout(()=>n.remove(), 4000);
  }

  function showStep(i){
    if(i<0 || i>=steps.length) return;
    idx = i; locked = false;

    const want = steps[i].img;
    const needSwap = shot.src !== want;

    spot.hidden = true; tip.hidden = true; guide.hidden = true;
    loading.hidden = false; loading.textContent = '이미지 로딩 중…';

    // onload가 오지 않아도 1.2초 후 강제 진행(폴백)
    let forced = false;
    const fallback = setTimeout(()=>{
      forced = true;
      loading.hidden = true;
      place(i);
      note('⚠️ 이미지 onload 지연 — 폴백으로 진행');
    }, 1200);

    shot.onerror = () => {
      clearTimeout(fallback);
      loading.hidden = true;
      note('❌ 이미지 로드 실패: '+want);
      prog.textContent = '이미지 로드 실패';
    };

    shot.onload = () => {
      if(forced) return; // 이미 폴백으로 진행했다면 무시
      clearTimeout(fallback);
      loading.hidden = true;
      place(i);
      shot.onload = null;
    };

    if(needSwap) shot.src = want; else { loading.hidden=true; place(i); }
  }

  spot.addEventListener('click', ()=>{
    if(locked) return;
    locked = true; spot.classList.add('busy'); guide.hidden = true;
    setTimeout(()=>{
      spot.classList.remove('busy');
      if(idx < steps.length-1) showStep(idx+1);
      else { spot.hidden=true; tip.hidden=true; guide.hidden=true; prog.textContent='Done ✓'; updateButtons(); }
    }, 600);
  });

  startBtn.onclick = ()=>showStep(0);
  prevBtn.onclick  = ()=>{ if(idx>0) showStep(idx-1); };
  nextBtn.onclick  = ()=>{ if(idx<steps.length-1) showStep(idx+1); };

  let t; window.addEventListener('resize',()=>{ clearTimeout(t); t=setTimeout(()=>{ if(idx>=0) place(idx); },100); });
</script>
</body>
</html>
